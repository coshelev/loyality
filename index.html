<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="index.css" type="text/css">
	<title>Анкета опроса</title>
	<title>Questionnaire</title>
  <style>
    .question {
      display: none;
    }
  </style>

</head>
<body  class="body">
<div>	

	<form id = "myForm"  method = "post" action="https://luidor.ru/sk/llt/handler.php">

	<div id ="div_Caption_id" class = "caption">Мы благодарим Вас за то, что Вы воспользовались услугами техцентра Луидор</div>

	<div class = "question">
		<div>
			<label class="label_question"> Оцените, пожалуйста, насколько Вы остались довольны услугами нашего сервисного центра?</label>
		</div>
		<div class = "divider_in_question"><br></div>
		<div class="div_radios">
			<label for="question11" class="label_radio" style="background-color: darkred"><input type="radio" id="question11" name="question1" class = "radio" value="1">	1</label>
			<label for="question12" class="label_radio" style="background-color: firebrick"><input type="radio" id="question12" name="question1" class = "radio" value="2">	2</label>
			<label for="question13" class="label_radio" style="background-color: red"><input type="radio" id="question13" name="question1" class = "radio" value="3">	3</label>
			<label for="question14" class="label_radio" style="background-color: orangered"><input type="radio" id="question14" name="question1" class = "radio" value="4">	4</label>
			<label for="question15" class="label_radio" style="background-color: darkorange"><input type="radio" id="question15" name="question1" class = "radio" value="5">	5</label>
			<label for="question16" class="label_radio" style="background-color: orange"><input type="radio" id="question16" name="question1" class = "radio" value="6">	6</label>
			<label for="question17" class="label_radio" style="background-color: gold"><input type="radio" id="question17" name="question1" class = "radio" value="7">	7</label>
			<label for="question18" class="label_radio" style="background-color: yellow"><input type="radio" id="question18" name="question1" class = "radio" value="8">	8</label>
			<label for="question19" class="label_radio" style="background-color: palegreen"><input type="radio" id="question19" name="question1" class = "radio" value="9">	9</label>
			<label for="question1a" class="label_radio" style="background-color: springgreen"><input type="radio" id="question1a" name="question1" class = "radio" value="10"> 10</label>
		</div>

	</div>

	<div class = "divider"><br></div>
	
	<div class = "question">
		<div>
			<label> Оцените соблюдение согласованных с Вами сроков обслуживания автомобиля?</label>
		</div>
		<div class = "divider_in_question"><br></div>
		<div class="div_radios">
			<label for="question21" class="label_radio" style="background-color: darkred"><input type="radio" id="question21" name="question2" class = "radio" value="1"> 1</label>
			<label for="question22" class="label_radio" style="background-color: firebrick"><input type="radio" id="question22" name="question2" class = "radio" value="2"> 2</label>
			<label for="question23" class="label_radio" style="background-color: red"><input type="radio" id="question23" name="question2" class = "radio" value="3"> 3</label>
			<label for="question24" class="label_radio" style="background-color: orangered"><input type="radio" id="question24" name="question2" class = "radio" value="4"> 4</label>
			<label for="question25" class="label_radio" style="background-color: darkorange"><input type="radio" id="question25" name="question2" class = "radio" value="5">	5</label>
			<label for="question26" class="label_radio" style="background-color: orange"><input type="radio" id="question26" name="question2" class = "radio" value="6"> 6</label>
			<label for="question27" class="label_radio" style="background-color: gold"><input type="radio" id="question27" name="question2" class = "radio" value="7"> 7</label>
			<label for="question28" class="label_radio" style="background-color: yellow"><input type="radio" id="question28" name="question2" class = "radio" value="8"> 8</label>
			<label for="question29" class="label_radio" style="background-color: palegreen"><input type="radio" id="question29" name="question2" class = "radio" value="9"> 9</label>
			<label for="question2a" class="label_radio" style="background-color: springgreen"><input type="radio" id="question2a" name="question2" class = "radio" value="10"> 10</label>
		</div>
	</div>
	
	<div class = "divider"><br></div>

	<div class = "question">
		<div>
			<label> Оцените предоставление информации о необходимых работах и их стоимости?</label>
		</div>
		<div class = "divider_in_question"><br></div>
		<div class="div_radios">			
  			<label for="question31" class="label_radio" style="background-color: darkred"><input type="radio" id="question31" name="question3" class = "radio" value="1"> 1</label>
			<label for="question32" class="label_radio" style="background-color: firebrick"><input type="radio" id="question32" name="question3" class = "radio" value="2"> 2</label>
			<label for="question33" class="label_radio" style="background-color: red"><input type="radio" id="question33" name="question3" class = "radio" value="3"> 3</label>
			<label for="question34" class="label_radio" style="background-color: orangered"><input type="radio" id="question34" name="question3" class = "radio" value="4">	4</label>
			<label for="question35" class="label_radio" style="background-color: darkorange"><input type="radio" id="question35" name="question3" class = "radio" value="5"> 5</label>
			<label for="question36" class="label_radio" style="background-color: orange"><input type="radio" id="question36" name="question3" class = "radio" value="6"> 6</label>
			<label for="question37" class="label_radio" style="background-color: gold"><input type="radio" id="question37" name="question3" class = "radio" value="7"> 7</label>	
			<label for="question38" class="label_radio" style="background-color: yellow"><input type="radio" id="question38" name="question3" class = "radio" value="8"> 8</label>
			<label for="question39" class="label_radio" style="background-color: palegreen"><input type="radio" id="question39" name="question3" class = "radio" value="9"> 9</label>
			<label for="question3a" class="label_radio" style="background-color: springgreen"><input type="radio" id="question3a" name="question3" class = "radio" value="10"> 10</label>
		</div>
	</div>

	<div class = "divider"><br></div>

	<div class = "question">
		<div>
			<label> Оцените качество выполненных работ?</label>
		</div>
		<div class = "divider_in_question"><br></div>
		<div class="div_radios">
			<label for="question41" class="label_radio" style="background-color: darkred"><input type="radio" id="question41" name="question4" class = "radio" value="1"> 1</label>
			<label for="question42" class="label_radio" style="background-color: firebrick"><input type="radio" id="question42" name="question4" class = "radio" value="2"> 2</label>
			<label for="question43" class="label_radio" style="background-color: red"><input type="radio" id="question43" name="question4" class = "radio" value="3"> 3</label>
			<label for="question44" class="label_radio" style="background-color: orangered"><input type="radio" id="question44" name="question4" class = "radio" value="4"> 4</label>
			<label for="question45" class="label_radio" style="background-color: darkorange"><input type="radio" id="question45" name="question4" class = "radio" value="5"> 5</label>
			<label for="question46" class="label_radio" style="background-color: orange"><input type="radio" id="question46" name="question4" class = "radio" value="6"> 6</label>
			<label for="question47" class="label_radio" style="background-color: gold"><input type="radio" id="question47" name="question4" class = "radio" value="7"> 7</label>
			<label for="question48" class="label_radio" style="background-color: yellow"><input type="radio" id="question48" name="question4" class = "radio" value="8"> 8</label>
			<label for="question49" class="label_radio" style="background-color: palegreen"><input type="radio" id="question49" name="question4" class = "radio" value="9"> 9</label>
			<label for="question4a" class="label_radio" style="background-color: springgreen"><input type="radio" id="question4a" name="question4" class = "radio" value="10"> 10</label>
		</div>
	</div>

	<div class = "divider"><br></div>

	<div class = "question">
		<div>
			<label> Опишите, пожалуйста, что Вам не понравилось?</label>
		</div>
		<div class = "divider_in_question"><br></div>

		<div class = "div_comment1">
			<textarea id="question5_comment"name="question5_comment" class="textarea_comment" rows="4"></textarea>
		</div>
	</div>


	<div class = "divider"><br></div>

	<div class = "divsubmit">	
		<input type="submit" class = "btnsubmit" value="Отправить">  	
	</div>

	</form>


</div>
</body>

<script src = getCaption.js>
	const poc = new URLSearchParams(window.location.search).get("pc");	
	console.log(poc);
	let address = '';
	if (poc == 'kgc'|| poc == 'kgg') address = 'ул. Ярослава Гашека, 7, корп. 1';
	if (poc == 'ksg'|| poc == 'kgc'|| poc == 'kgc') address = 'Сибирский тракт, 59';
	if (poc == 'cmg'|| poc == 'cmk') address = 'ул. Механическая, 14/5';
	if (poc == 'cvk') address = 'ул. Валдайская, 17Б';
	if (poc == 'sgt') address = 'ул. Пролетарская, 142А';
	if (poc == 'stk') address = 'ул. Пролетарская, 144А';
	if (poc == 'stg') address = 'ул. Пролетарская, 142А';
	if (poc == 'ttg') address = 'Моршанское ш., 24Б';
	if (poc == 'uvtg') address = 'Трактовая ул., 15';
	if (poc == 'chtg') address = 'Марпосадское ш., 1Д';
	if (poc == 'g12tg') address = 'ул. Ларина, 12к1';
	if (poc == 'g18tg') address = 'ул. Ларина, 18';
	if (poc == 'gptg') address = 'ул. Поющева, 22';
	const divCaption = document.getElementById("div_Caption_id");
	divCaption.innerHTML = 'Мы благодарим Вас за то, что Вы воспользовались услугами техцентра Луидор'+' '+address;
</script>

<script> 
	let positive = 0
</script>

<script>
  	
	document.addEventListener("DOMContentLoaded", function() {
        const questions = document.querySelectorAll(".question");
        let currentQuestionIndex = 0;
	let currentPositive = 0;
        // Show the first question initially
        questions[currentQuestionIndex].style.display = "block";

        // Attach event listeners to radio inputs
        const radioInputs = document.querySelectorAll(".radio");
        radioInputs.forEach(function(input) {
            input.addEventListener("change", function() {
                // Get the value of the selected radio input
                const selectedValue = input.value;
                // If the selected value is 1-8, move to the next question
                if ( selectedValue <= 8) {
                    // Hide the current question
                    questions[currentQuestionIndex].style.display = "none";
                    // Move to the next question
                    currentQuestionIndex++;
                    currentPositive = 0;		
					// If there's a next question, show it
                    if (currentQuestionIndex < questions.length) {
                        questions[currentQuestionIndex].style.display = "block";
						currentPositive++;
                    }
                };
		//If it is the first question and selected value > 10 - complete
		if (currentQuestionIndex ==0 || selectedValue > 8) {
			positive = 1;	
		};
            });
        });
    });
	
	//Define input parameters
	const params = new URLSearchParams(window.location.search);
	
	const pc = params.get("pc");
	console.log(pc);
	const pointCode = pc;
	const mz = params.get("mz");
	console.log(mz);
	const ch = params.get("ch");
	console.log(ch);
	const channel = ch;
	const ph = params.get("ph");
	console.log(ph);
	const phone = ph;

	const currentDate = new Date();
	const isoString = currentDate.toISOString();
	const year = isoString.slice(0, 4);
	const month = isoString.slice(5, 7);
	const day = isoString.slice(8, 10);
	const dateString = year+month+day;

	

	const form = document.getElementById('myForm');
  	form.addEventListener('submit', (event) => {
    		event.preventDefault(); 				// prevent default form submission
    		const formData = new FormData(form); 			// create a new FormData object
    		const data = {}; 	// create an empty object to store form data

		data['type'] 		= 'loyaltysto';
		data['pointCode'] 	= pointCode;
		data['mz'] 		= mz;
		data['channel'] 	= channel;
		data['phone']		= phone;
		data['date']		= dateString;

		console.log(positive);
		
		//Fill up answers
		for (const [key, value] of formData.entries()){
			//Fill structure
			data[key] = value; // add form data to object

			//Is questionnaire positive?
			if (key=="question1" && value >8)  {positive = positive+1}; 
			
		};
		const jsonData = JSON.stringify(data); 			// convert object to JSON string
		console.log(jsonData); 	


    		// send JSON string to server using AJAX or fetch API		
		const url = 'https://luidor.ru/sk/llt/handler.php';
		const options = {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(jsonData)};

		fetch(url, options).then(() =>
			{
			document.body.innerHTML = '';

			if (positive > 0){
				
				//Add just a text
				var par  = document.createElement("p");
				var text = document.createTextNode("Благодарим Вас за высокую оценку!");
				par.appendChild(text);
				par.style.color = 'red';
				par.style.fontSize = 'xx-large';
				document.body.appendChild(par);

				//Add yandex map link
				//---------------------
    				const link = document.createElement('a');
				
				//default URL
    				link.href = 'https://maps.yandex.ru';

				//Kazan
					if (pointCode == 'kgc') link.href = 'https://yandex.ru/maps/org/202117238419';
					if (pointCode == 'kgg') link.href = 'https://yandex.ru/maps/-/CDQSM-nP';
					if (pointCode == 'ksg') link.href = 'https://yandex.ru/maps/-/CDQK5I2x';
					if (pointCode == 'ksu') link.href = 'https://yandex.ru/maps/-/CDQK5U~c';
					if (pointCode == 'ksf') link.href = 'https://yandex.ru/maps/-/CDQK5R~-';

				//Saransk
					if (pointCode == 'sgt') link.href = 'https://yandex.ru/maps/-/CDaWn-if';
					if (pointCode == 'stk') link.href = 'https://yandex.ru/maps/-/CDaWn2-d';
					if (pointCode == 'stg') link.href = 'https://yandex.ru/maps/org/55996023099';
				
				//Chelyabinsk
					if (pointCode == 'cmg') link.href = 'https://yandex.ru/maps/-/CDaYEG8m';
					if (pointCode == 'cmk') link.href = 'https://yandex.ru/maps/-/CDaYEC6f';
					if (pointCode == 'cvk') link.href = 'https://yandex.ru/maps/-/CDaYUY62';
				
				//Ufa
					if (pointCode == 'uvtg') link.href = 'https://yandex.ru/maps/org/195787811006';
				
				//Cheboksary
					if (pointCode == 'chtg') link.href = 'https://yandex.ru/maps/-/CDBCiUjO';
				
				//Tambov
					if (pointCode == 'ttg') link.href = 'https://yandex.ru/maps/org/1785393162';
				
				//NN
					if (pointCode == 'g12tg') link.href = 'https://yandex.ru/maps/org/189643444831';
					if (pointCode == 'g18tg') link.href = 'https://yandex.ru/maps/org/196508773221';
					if (pointCode == 'gptg') link.href = 'https://yandex.ru/maps/org/1115062577';
				

    			link.textContent = 'Оставте пожалуйста положительный отзыв по этой ссылке на Яндекс Картах'; 
				link.style.color = 'blue';
				link.style.textDecoration = 'underline';  
				link.style.fontSize = 'xx-large'; 			
    			document.body.appendChild(link);};
			
			if (positive == 0){
				document.body.innerHTML = 'Спасибо за обратную связь!';};

			}
		);
  	});
</script>

</html>

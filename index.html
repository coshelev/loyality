<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="index.css" type="text/css">
	<title>Анкета опроса</title>
</head>
<body  class="body">
<div>	

	<form id = "myForm"  method = "post" action="https://luidor.ru/sk/llt/handler.php">

	<div id ="div_Caption_id" class = "caption">!Мы благодарим Вас за то, что Вы воспользовались услугами техцентра Луидор по адресу ул. Ярослава Гашека, 7, корп. 1</div>

	<div class = "question">
		<div>
			<label class="label_question"> Оцените, пожалуйста, насколько Вы остались довольны услугами нашего сервисного центра?</label>
		</div>
		<div class = "divider_in_question"><br></div>
		<div class="div_radios">
			<label for="question11" class="label_radio" style="background-color: darkred"><input type="radio" id="question11" name="question1" class = "radio" value="1">	1</label>
			<label for="question12" class="label_radio" style="background-color: firebrick"><input type="radio" id="question12" name="question1" class = "radio" value="2">	2</label>
			<label for="question13" class="label_radio" style="background-color: red"><input type="radio" id="question13" name="question1" class = "radio" value="3">	3</label>
			<label for="question14" class="label_radio" style="background-color: orangered"><input type="radio" id="question14" name="question1" class = "radio" value="4">	4</label>
			<label for="question15" class="label_radio" style="background-color: darkorange"><input type="radio" id="question15" name="question1" class = "radio" value="5">	5</label>
			<label for="question16" class="label_radio" style="background-color: orange"><input type="radio" id="question16" name="question1" class = "radio" value="6">	6</label>
			<label for="question17" class="label_radio" style="background-color: gold"><input type="radio" id="question17" name="question1" class = "radio" value="7">	7</label>
			<label for="question18" class="label_radio" style="background-color: yellow"><input type="radio" id="question18" name="question1" class = "radio" value="8">	8</label>
			<label for="question19" class="label_radio" style="background-color: palegreen"><input type="radio" id="question19" name="question1" class = "radio" value="9">	9</label>
			<label for="question1a" class="label_radio" style="background-color: springgreen"><input type="radio" id="question1a" name="question1" class = "radio" value="10"> 10</label>
		</div>

	</div>

	<div class = "divider"><br></div>
	
	<div class = "question">
		<div>
			<label> Оцените соблюдение согласованных с Вами сроков обслуживания автомобиля?</label>
		</div>
		<div class = "divider_in_question"><br></div>
		<div class="div_radios">
			<label for="question21" class="label_radio" style="background-color: darkred"><input type="radio" id="question21" name="question2" class = "radio" value="1"> 1</label>
			<label for="question22" class="label_radio" style="background-color: firebrick"><input type="radio" id="question22" name="question2" class = "radio" value="2"> 2</label>
			<label for="question23" class="label_radio" style="background-color: red"><input type="radio" id="question23" name="question2" class = "radio" value="3"> 3</label>
			<label for="question24" class="label_radio" style="background-color: orangered"><input type="radio" id="question24" name="question2" class = "radio" value="4"> 4</label>
			<label for="question25" class="label_radio" style="background-color: darkorange"><input type="radio" id="question25" name="question2" class = "radio" value="5">	5</label>
			<label for="question26" class="label_radio" style="background-color: orange"><input type="radio" id="question26" name="question2" class = "radio" value="6"> 6</label>
			<label for="question27" class="label_radio" style="background-color: gold"><input type="radio" id="question27" name="question2" class = "radio" value="7"> 7</label>
			<label for="question28" class="label_radio" style="background-color: yellow"><input type="radio" id="question28" name="question2" class = "radio" value="8"> 8</label>
			<label for="question29" class="label_radio" style="background-color: palegreen"><input type="radio" id="question29" name="question2" class = "radio" value="9"> 9</label>
			<label for="question2a" class="label_radio" style="background-color: springgreen"><input type="radio" id="question2a" name="question2" class = "radio" value="10"> 10</label>
		</div>
	</div>
	
	<div class = "divider"><br></div>

	<div class = "question">
		<div>
			<label> Оцените предоставление информации о необходимых работах и их стоимости?</label>
		</div>
		<div class = "divider_in_question"><br></div>
		<div class="div_radios">			
  			<label for="question31" class="label_radio" style="background-color: darkred"><input type="radio" id="question31" name="question3" value="1"> 1</label>
			<label for="question32" class="label_radio" style="background-color: firebrick"><input type="radio" id="question32" name="question3" value="2"> 2</label>
			<label for="question33" class="label_radio" style="background-color: red"><input type="radio" id="question33" name="question3" value="3"> 3</label>
			<label for="question34" class="label_radio" style="background-color: orangered"><input type="radio" id="question34" name="question3" value="4">	4</label>
			<label for="question35" class="label_radio" style="background-color: darkorange"><input type="radio" id="question35" name="question3" value="5"> 5</label>
			<label for="question36" class="label_radio" style="background-color: orange"><input type="radio" id="question36" name="question3" value="6"> 6</label>
			<label for="question37" class="label_radio" style="background-color: gold"><input type="radio" id="question37" name="question3" value="7"> 7</label>	
			<label for="question38" class="label_radio" style="background-color: yellow"><input type="radio" id="question38" name="question3" value="8"> 8</label>
			<label for="question39" class="label_radio" style="background-color: palegreen"><input type="radio" id="question39" name="question3" value="9"> 9</label>
			<label for="question3a" class="label_radio" style="background-color: springgreen"><input type="radio" id="question3a" name="question3" value="10"> 10</label>
		</div>
	</div>

	<div class = "divider"><br></div>

	<div class = "question">
		<div>
			<label> Оцените качество выполненных работ?</label>
		</div>
		<div class = "divider_in_question"><br></div>
		<div class="div_radios">
			<label for="question41" class="label_radio" style="background-color: darkred"><input type="radio" id="question41" name="question4" value="1"> 1</label>
			<label for="question42" class="label_radio" style="background-color: firebrick"><input type="radio" id="question42" name="question4" value="2"> 2</label>
			<label for="question43" class="label_radio" style="background-color: red"><input type="radio" id="question43" name="question4" value="3"> 3</label>
			<label for="question44" class="label_radio" style="background-color: orangered"><input type="radio" id="question44" name="question4" value="4"> 4</label>
			<label for="question45" class="label_radio" style="background-color: darkorange"><input type="radio" id="question45" name="question4" value="5"> 5</label>
			<label for="question46" class="label_radio" style="background-color: orange"><input type="radio" id="question46" name="question4" value="6"> 6</label>
			<label for="question47" class="label_radio" style="background-color: gold"><input type="radio" id="question47" name="question4" value="7"> 7</label>
			<label for="question48" class="label_radio" style="background-color: yellow"><input type="radio" id="question48" name="question4" value="8"> 8</label>
			<label for="question49" class="label_radio" style="background-color: palegreen"><input type="radio" id="question49" name="question4" value="9"> 9</label>
			<label for="question4a" class="label_radio" style="background-color: springgreen"><input type="radio" id="question4a" name="question4" value="10"> 10</label>
		</div>
	</div>

	<div class = "divider"><br></div>

	<div class = "question">
		<div>
			<label> Поделитесь, пожалуйста, что Вам не понравилось</label>
		</div>
		<div class = "divider_in_question"><br></div>

		<div class = "div_comment1">
			<textarea id="question5_comment"name="question5_comment" class="textarea_comment" rows="4"></textarea>
		</div>
	</div>


	<div class = "divider"><br></div>

	<div class = "divsubmit">	
		<input type="submit" class = "btnsubmit" value="Отправить">  	
	</div>

	</form>


</div>
</body>
<script src = getCaption.js></script>

<script>
  	//Define input parameters
	const params = new URLSearchParams(window.location.search);
	
	const pc = params.get("pc");
	console.log(pc);
	const pointCode = pc;
	const mz = params.get("mz");
	console.log(mz);
	const ch = params.get("ch");
	console.log(ch);
	const channel = ch;
	const ph = params.get("ph");
	console.log(ph);
	const phone = ph;

	const currentDate = new Date();
	const isoString = currentDate.toISOString();
	const year = isoString.slice(0, 4);
	const month = isoString.slice(5, 7);
	const day = isoString.slice(8, 10);
	const dateString = year+month+day;

	

	const form = document.getElementById('myForm');
  	form.addEventListener('submit', (event) => {
    		event.preventDefault(); 				// prevent default form submission
    		const formData = new FormData(form); 			// create a new FormData object
    		const data = {}; 	// create an empty object to store form data

		data['type'] 		= 'loyaltysto';
		data['pointCode'] 	= pointCode;
		data['mz'] 		= mz;
		data['channel'] 	= channel;
		data['phone']		= phone;
		data['date']		= dateString;
	

		let positive = 0;
    		for (const [key, value] of formData.entries())
			{
				//Fill structure
				data[key] = value; // add form data to object

				//Is questionnaire positive?
				if (key=="question1" && value >8)  {positive = positive+1}; 
			
			};

		console.log(positive);
		
			
    		const jsonData = JSON.stringify(data); 			// convert object to JSON string
    		console.log(jsonData); 					// log JSON string to console (for testing)

    		// send JSON string to server using AJAX or fetch API		
		const url = 'https://luidor.ru/sk/llt/handler.php';
		const options = {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(jsonData)};

		fetch(url, options).then(() =>
			{
			document.body.innerHTML = '';

			if (positive > 0){
    				const link = document.createElement('a');
				
				//default URL
    				link.href = 'https://maps.yandex.ru';

				//Kazan
				if (pointCode == 'kgc') link.href = 'https://yandex.ru/maps/org/202117238419';
				if (pointCode == 'kgg') link.href = 'https://yandex.ru/maps/-/CDQSM-nP';
				if (pointCode == 'ksg') link.href = 'https://yandex.ru/maps/-/CDQK5I2x';
				if (pointCode == 'ksu') link.href = 'https://yandex.ru/maps/-/CDQK5U~c';
				if (pointCode == 'ksf') link.href = 'https://yandex.ru/maps/-/CDQK5R~-';

				//Saransk
				if (pointCode == 'sgt') link.href = 'https://yandex.ru/maps/-/CDaWn-if';
				if (pointCode == 'stk') link.href = 'https://yandex.ru/maps/-/CDaWn2-d';
				
				//Chelyabinsk
				if (pointCode == 'cmg') link.href = 'https://yandex.ru/maps/-/CDaYEG8m';
				if (pointCode == 'cmk') link.href = 'https://yandex.ru/maps/-/CDaYEC6f';
				if (pointCode == 'cvk') link.href = 'https://yandex.ru/maps/-/CDaYUY62';


    			link.textContent = 'Оставте пожалуйста положительный отзыв на Яндекс Картах'; 
				link.style.color = 'blue';
				link.style.textDecoration = 'underline';  
				link.style.fontSize = 'xx-large'; 			
    				document.body.appendChild(link);};
			if (positive == 0){
				document.body.innerHTML = 'Спасибо за обратную связь!';};

			}
		);
  	});
</script>

</html>
